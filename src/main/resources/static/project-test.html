<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>é¡¹ç›®ç®¡ç†æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 { color: #333; text-align: center; }
        h2 { color: #666; border-bottom: 2px solid #eee; padding-bottom: 10px; }

        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            height: 60px;
            resize: vertical;
        }

        button {
            margin: 10px 5px;
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        button.danger {
            background: #dc3545;
        }
        button.danger:hover {
            background: #c82333;
        }
        button.success {
            background: #28a745;
        }
        button.success:hover {
            background: #218838;
        }

        #result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            background: #f9f9f9;
            white-space: pre-wrap;
            font-family: monospace;
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
        }

        .projects-list {
            margin-top: 20px;
        }
        .project-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        .project-name {
            font-weight: bold;
            color: #007bff;
            font-size: 16px;
        }
        .project-description {
            color: #666;
            margin: 5px 0;
        }
        .project-path {
            font-family: monospace;
            background: #e9ecef;
            padding: 5px;
            border-radius: 3px;
            font-size: 12px;
        }
        .project-actions {
            margin-top: 10px;
        }
        .project-actions button {
            margin: 2px;
            padding: 5px 10px;
            font-size: 12px;
        }

        .section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸš€ ç®€åŒ–ç‰ˆä»£ç å®¡æŸ¥ç³»ç»Ÿ - é¡¹ç›®ç®¡ç†</h1>

    <!-- åˆ›å»ºé¡¹ç›® -->
    <div class="section">
        <h2>ğŸ“ åˆ›å»ºæ–°é¡¹ç›®</h2>
        <div class="form-group">
            <label for="projectName">é¡¹ç›®åç§° *</label>
            <input type="text" id="projectName" placeholder="ä¾‹å¦‚: my-awesome-project">
        </div>
        <div class="form-group">
            <label for="projectDescription">é¡¹ç›®æè¿°</label>
            <textarea id="projectDescription" placeholder="é¡¹ç›®çš„è¯¦ç»†æè¿°..."></textarea>
        </div>
        <div class="form-group">
            <label for="projectGitPath">Gitä»“åº“è·¯å¾„ *</label>
            <input type="text" id="projectGitPath" placeholder="ä¾‹å¦‚: D:/projects/my-repo æˆ– /path/to/repo">
        </div>
        <button onclick="createProject()" class="success">åˆ›å»ºé¡¹ç›®</button>
    </div>

    <!-- é¡¹ç›®æ“ä½œ -->
    <div class="section">
        <h2>ğŸ”§ é¡¹ç›®æ“ä½œ</h2>
        <button onclick="getAllProjects()">ğŸ“‹ è·å–æ‰€æœ‰é¡¹ç›®</button>
        <button onclick="refreshProjects()" class="success">ğŸ”„ åˆ·æ–°é¡¹ç›®åˆ—è¡¨</button>

        <div style="margin-top: 15px;">
            <input type="text" id="searchProjectName" placeholder="è¾“å…¥é¡¹ç›®åç§°æŸ¥è¯¢è¯¦æƒ…..." style="width: 300px; display: inline-block;">
            <button onclick="getProjectDetails()">ğŸ” æŸ¥è¯¢é¡¹ç›®è¯¦æƒ…</button>
            <button onclick="getProjectBranches()">ğŸŒ² è·å–åˆ†æ”¯åˆ—è¡¨</button>
        </div>
    </div>

    <!-- é¡¹ç›®åˆ—è¡¨ -->
    <div class="section">
        <h2>ğŸ“ é¡¹ç›®åˆ—è¡¨</h2>
        <div id="projectsList"></div>
    </div>

    <!-- ç»“æœæ˜¾ç¤º -->
    <div class="section">
        <h2>ğŸ“Š æ“ä½œç»“æœ</h2>
        <button onclick="clearResult()">æ¸…ç©ºç»“æœ</button>
        <div id="result"></div>
    </div>
</div>

<script>
    const baseUrl = 'http://localhost:8080/api';

    function showResult(data) {
        const resultDiv = document.getElementById('result');
        resultDiv.textContent = JSON.stringify(data, null, 2);
        resultDiv.scrollTop = resultDiv.scrollHeight;
    }

    function clearResult() {
        document.getElementById('result').textContent = '';
    }

    async function createProject() {
        const name = document.getElementById('projectName').value.trim();
        const description = document.getElementById('projectDescription').value.trim();
        const gitPath = document.getElementById('projectGitPath').value.trim();

        if (!name) {
            alert('è¯·è¾“å…¥é¡¹ç›®åç§°');
            return;
        }

        if (!gitPath) {
            alert('è¯·è¾“å…¥Gitä»“åº“è·¯å¾„');
            return;
        }

        try {
            const response = await fetch(`${baseUrl}/projects`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name: name,
                    description: description || 'æ— æè¿°',
                    gitPath: gitPath
                })
            });

            const data = await response.json();
            showResult(data);

            if (data.success) {
                // æ¸…ç©ºè¡¨å•
                document.getElementById('projectName').value = '';
                document.getElementById('projectDescription').value = '';
                document.getElementById('projectGitPath').value = '';

                // åˆ·æ–°é¡¹ç›®åˆ—è¡¨
                refreshProjects();
            }
        } catch (error) {
            showResult({error: error.message});
        }
    }

    async function getAllProjects() {
        try {
            const response = await fetch(`${baseUrl}/projects`);
            const data = await response.json();
            showResult(data);
            updateProjectsList(data.projects || []);
        } catch (error) {
            showResult({error: error.message});
        }
    }

    async function refreshProjects() {
        await getAllProjects();
    }

    async function getProjectDetails() {
        const projectName = document.getElementById('searchProjectName').value.trim();
        if (!projectName) {
            alert('è¯·è¾“å…¥é¡¹ç›®åç§°');
            return;
        }

        try {
            const response = await fetch(`${baseUrl}/projects/${encodeURIComponent(projectName)}`);
            const data = await response.json();
            showResult(data);
        } catch (error) {
            showResult({error: error.message});
        }
    }

    async function getProjectBranches() {
        const projectName = document.getElementById('searchProjectName').value.trim();
        if (!projectName) {
            alert('è¯·è¾“å…¥é¡¹ç›®åç§°');
            return;
        }

        try {
            const response = await fetch(`${baseUrl}/projects/${encodeURIComponent(projectName)}/branches`);
            const data = await response.json();
            showResult(data);
        } catch (error) {
            showResult({error: error.message});
        }
    }

    async function deleteProject(projectName) {
        if (!confirm(`ç¡®å®šè¦åˆ é™¤é¡¹ç›® "${projectName}" å—ï¼Ÿ`)) {
            return;
        }

        try {
            const response = await fetch(`${baseUrl}/projects/${encodeURIComponent(projectName)}`, {
                method: 'DELETE'
            });
            const data = await response.json();
            showResult(data);

            if (data.success) {
                refreshProjects();
            }
        } catch (error) {
            showResult({error: error.message});
        }
    }

    async function viewProjectBranches(projectName) {
        try {
            const response = await fetch(`${baseUrl}/projects/${encodeURIComponent(projectName)}/branches`);
            const data = await response.json();
            showResult(data);
        } catch (error) {
            showResult({error: error.message});
        }
    }

    function updateProjectsList(projects) {
        const listDiv = document.getElementById('projectsList');

        if (!projects || projects.length === 0) {
            listDiv.innerHTML = '<p style="color: #666; text-align: center;">æš‚æ— é¡¹ç›®</p>';
            return;
        }

        listDiv.innerHTML = projects.map(project => `
                <div class="project-item">
                    <div class="project-name">${project.name}</div>
                    <div class="project-description">${project.description || 'æ— æè¿°'}</div>
                    <div class="project-path">ğŸ“ ${project.gitPath}</div>
                    <div style="font-size: 12px; color: #999; margin-top: 5px;">
                        é»˜è®¤åˆ†æ”¯: ${project.defaultBranch || 'main'} |
                        åˆ›å»ºæ—¶é—´: ${new Date(project.createdAt).toLocaleString()}
                    </div>
                    <div class="project-actions">
                        <button onclick="viewProjectBranches('${project.name}')" class="success">æŸ¥çœ‹åˆ†æ”¯</button>
                        <button onclick="deleteProject('${project.name}')" class="danger">åˆ é™¤é¡¹ç›®</button>
                    </div>
                </div>
            `).join('');
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–é¡¹ç›®åˆ—è¡¨
    window.onload = function() {
        getAllProjects();
    };
</script>
</body>
</html>